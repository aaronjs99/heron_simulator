###########################################################
# DLIO Configuration for Heron USV Simulation
# Matches sensor positions from heron_sim.urdf.xacro
###########################################################

dlio:

  version: 1.1.1

  adaptive: true

  odom:
    odom_frame: "odom"
    child_frame: "base_link"
    gravity: 9.80665
    # GICP parameters
    gicp:
      minNumPoints: 10
      maxIterations: 15
      kCorrespondences: 5
      maxCorrespondenceDistance: 1.5

    # Override IMU calibration to skip startup delay
    imu:
      calibration:
        time: 0.01

  # Frame IDs - using defaults (DLIO internal only)
  frames:
    map: "map"
    odom: "odom"
    baselink: "base_link"
    lidar: "lidar_h_link"
    imu: "imu_link"

  pointcloud:
    deskew: true
    voxelize: true

  imu:
    calibration: false # Disable for sim
    intrinsics:
      accel:
        bias: [ 0.0, 0.0, 0.0 ]
        sm:   [ 1.,  0.,  0.,
            0.,  1.,  0.,
            0.,  0.,  1. ]
        noise: 0.005  # derived from sqrt(2.5e-05)
      gyro:
        bias: [ 0.0, 0.0, 0.0 ]
        noise: 0.005  # derived from sqrt(2.5e-05)

  # Extrinsics for Heron USV
  # User frame (x-fwd, y-right, z-down) -> ROS frame (x-fwd, y-left, z-up)
  # Y and Z are negated
  # lidar_h: user (0, -91, -268.3)mm -> ROS (0, +0.091, 0.2683)m
  # IMU: user (65.6, -91, -203)mm -> ROS (0.0656, +0.091, 0.203)m
  extrinsics:
    baselink2imu:
      t: [ 0.0656, 0.091, 0.203 ]
      R: [ 1.,  0.,  0.,
           0.,  1.,  0.,
           0.,  0.,  1. ]
    baselink2lidar:
      t: [ 0.,  0.091,  0.2683 ]
      R: [ 1.,  0.,  0.,
           0.,  1.,  0.,
           0.,  0.,  1. ]

  map:
    sparse:
      leafSize: 0.25
    publish_map_tf: true
    waitUntilMove: false
